<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Zacomments</title>
		<meta name="referrer" content="always"/>
		<meta name="keywords" content="zacomments,comments,topics">
		<meta name="description" content="Your Zacomments all belong to us.">
		<meta property="og:site_name" content="Zacomments" />
		<meta property="og:type" content="website" />
		<meta property="og:url" content="http://zacomments.azurewebsites.net" />
		<meta property="og:title" content="Zacomments" />
		<meta property="og:description" content="Your Zacomments all belong to us." />
		
		<meta name="viewport" content="width=device-width">
		<link rel="stylesheet" class="cssStatics" type="text/css" href="Facebook-Link-Preview-master/css/stylesheet.css" />
		<link rel="stylesheet" class="cssButtons" type="text/css" href="Facebook-Link-Preview-master/css/linkPreview.css" />
	    	<link rel="stylesheet" type="text/css" href="css/jquery.tagsinput.css" />
	    	
		<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>
    		<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    		<script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.2.2/backbone-min.js"></script>
		<script src="//d3f5pyioow99x0.cloudfront.net/0.8.48/hull.js"></script>
	    	<script src="js/jquery.tagsinput.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
	    	<link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet"/>
		<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
		<script src="js/components.js"></script>
		<script type="text/javascript" src="Facebook-Link-Preview-master/js/linkPreview.js" ></script>
		<script type="text/javascript" src="Facebook-Link-Preview-master/js/linkPreviewRetrieve.js" ></script>
		<link rel="stylesheet" type="text/css" href="css/styles.css">


		<script type="text/javascript">
		    var Keen=Keen||{configure:function(e){this._cf=e},addEvent:function(e,t,n,i){this._eq=this._eq||[],this._eq.push([e,t,n,i])},setGlobalProperties:function(e){this._gp=e},onChartsReady:function(e){this._ocrq=this._ocrq||[],this._ocrq.push(e)}};(function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://":"http://")+"dc8na2hxrj29i.cloudfront.net/code/keen-2.1.0-min.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();
		
		    // Configure the Keen object with your Project ID and (optional) access keys.
		    Keen.configure({
		        projectId: "52c6e20836bf5a6dd0000015",
		        writeKey: "d523d28ca0cf1406ac6a4275d70c09f31e06fa575355a163f411a81ae4b9caabc73c211a53c93c14286da3e33ebfcb3696e8e5973da40ac16035c28c8f8c38eabcdc6fa15f2474edc748212d748475a62d59d6bcf9479b6b10fa187ae42f1245663fedbeabcc6af28df2dec0f2ff5b0d", // required for sending events
		        readKey: "98ec71562a7174440c4b628f1871282e333dd4e7df76994e3ebc269f49bea6bc356b567e8db69b5a0735d3bd3221cf31ebf5c4c780e61a5388f1550616536c286ecbdad69994dd51c183333c05e7fbe0f51ed695301c7470f6e3cceb2ca5db9c3d81593f41dd26419d5e96460f44380c"    // required for doing analysis
		    });
		</script>
	</head>
	
	<body class="center-block">
		
		<header id="mainHeader">
			<div class="verticallyCentered">
				<a class="logo" href="http://zacomments.azurewebsites.net/">
					<h3>ZaComments</h3>
					<p>I came for the comments...</p>
				</a>
				<form class="search">			
					<input type="text"  placeholder="Search Topics..." id="searchField">
					<button type="button" id="search"><i class="icon-search"></i></button>
		    		</form>
		    		<button type="button" id="Create" class="btn btn-default btn-warning create desktop" data-toggle="modal" data-target="#createTopicModal" style="visibility: hidden">Create Topic</button>
		    		<button type="button" id="searchButtonMobile" class="btn btn-default btn-small" data-toggle="modal" data-target="#mobileSearchModal"><i class="icon-search"></i></button>
		    		<button type="button" id="mobileCreate" class="btn btn-default btn-warning create mobile" data-toggle="modal" data-target="#createTopicModal" style="visibility: hidden"><i class="icon-plus"></i></button>
		    		<div class="login" data-hull-component="mylogin" data-hull-provider="facebook,twitter"></div>
			</div>
		</header>
				
		<main data-hull-component="maincomp"></main>   
	    
	    <script type='text/handlebars' data-hull-template='maincomp/maincomp'>
	        {{#if isAdmin}}
	            	<section data-hull-component="flaggedposts"></section>
	        {{/if}}
	       	{{#if loggedIn}}
	       		<section class="createTopic" data-hull-component="createtopicform"></section>
	    	{{/if}}
	    	<section data-hull-component="mobilesearchform"></section>

	    	<div id="mobileView">
	    		<ul class="nav nav-pills">
	    			<li class="active"><a data-toggle="pill" href="#newTopics">New Topics</a></li>
				<li><a data-toggle="pill" href="#hotTopics">Hot Topics</a></li>
			</ul>
			<div class="tab-content">
				<div id="newTopics" class="tab-pane fade in active">
					<section data-hull-component="newposts"></section>
				</div>
			        <div id="hotTopics" class="tab-pane fade">
			        	<section class="loading" data-hull-component="posts"></section> 
			        </div>
			</div>
		</div>
		<div id="desktopView">
		        <section id="mainSection" class="loading" data-hull-component="posts"></section> 
			<aside id="mainAside" data-hull-component="newposts"></aside>
		</div>
	    </script>
	            
	    <script type='text/x-handlebars' data-hull-template='posts/posts'>
	    	<h3 class="desktopOnly">Topics With Recent Activity</h3>
	        {{#each trendingPosts}}
	        	{{#if name}}
					<article>
		        		<section class="topic">
			                <h1 data-postID="{{id}}"><a href="#/post/{{id}}">{{name}}</a></h1>
			                {{#if tags}}
							<ul class="tagFeed">
			                    		{{#each tags}}
			                        		{{#if this}}
			                        			<li><a href="#/post/{{this.value}}"><i class="icon-tag icon-large"></i>{{this.label}}</a></li>
			                        		{{/if}}
			                    		{{/each}}
							</ul>
					{{/if}}
					<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/> 
					<div data-hull-component="share/button@hull" data-hull-text="{{name}}" data-hull-url="http://zacomments.azurewebsites.net/?post={{id}}" data-hull-providers='twitter,facebook'></div>

			                <ul>
				                <li>{{stats.comments}} comments</li>
								<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
			                </ul>	
					</section>
					<section class="createComment" data-hull-component="commentbox" data-hull-id="{{id}}"></section>
					<section data-hull-component="test" data-hull-id="{{id}}" data-hull-orderby="votes"></section>								
	        			</article>

	            {{/if}}
			{{/each}}
	       <footer>
		       <button type="button" id="loadMoreTrending" class="btn btn-primary btn-block has-spinner" data-hull-action="loadMoreTrending"><span class="spinner"><i class="icon-spin icon-refresh"></i></span> Load more posts</button>
	       </footer>
	    </script>
	    		    			
		<script type='text/x-handlebars' data-hull-template='newposts/newposts'>
			<h3 class="desktopOnly">New Topics</h3>
			{{#each newPosts}}
				{{#if name}}
				<article>
					<section class="topic">
						<h1 data-postID="{{id}}"><a href="#/post/{{id}}">{{name}}</a></h1>
						{{#if tags}}
						<ul class="tagFeed">
							{{#each tags}}
								{{#if this}}
									<li><a href="#/post/{{this.value}}"><i class="icon-tag icon-large"></i>{{this.label}}</a></li>
								{{/if}}
							{{/each}}				
						</ul>
						{{/if}}	
						<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>	
						<div data-hull-component="share/button@hull" data-hull-text="{{name}}" data-hull-url="http://zacomments.azurewebsites.net/?post={{id}}" data-hull-providers='twitter, facebook'></div>

						<ul>
							<li>{{stats.comments}} comments</li>
							<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
						</ul>
					</section>
					<section class="createComment" data-hull-component="commentbox" data-hull-id="{{id}}"></section>
					<section data-hull-component="test" data-hull-id="{{id}}" data-hull-orderby="votes"></section>
				</article>					
				{{/if}}
			{{/each}}
			<footer>
				<button type="button" id="loadMore" class="btn btn-primary btn-block has-spinner" data-hull-action="loadMore"><span class="spinner"><i class="icon-spin icon-refresh"></i></span> Load more posts</button>
			</footer>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='mylogin/mylogin'>
		    {{#if authHasFailed}}
			  <p class="alert alert-error">
			    There was an error signing in your account. Maybe you did not approve the app?
			  </p>
		    {{/if}}
			{{#if matchingProviders}}
			  <div class='media'>
			    {{#if me.picture}}
			    <div class="pull-left">
			    <a href="#/user/{{me.id}}">
			    	<img class="media-object img-rounded" src="{{me.picture}}" alt="{{me.name}}">
			    </a>
			    </div>
			    {{/if}}
			    <div class="pull-right">
			      <a data-hull-action="logout" class="btn btn-default">Log Out</a>
			    </div>
			    <!--
			    <div class="media-body">
			      <span class="media-heading">{{me.name}}</span>
			    </div>
			    -->
			  </div>
			{{else}}
			  {{#if loggedOut}}
			    <div class="close" data-hull-action="close"></div>
			    <p>Don't be a stalker! Sign in and join the action!</p>
			    <button type="button" class="btn btn-default" data-hull-action="toggleEmailLogin" id="toggleEmailLoginButton"><i class="icon-envelope"></i> Email</button>
			    <div class="hull-identity__signin">
			      {{#loggedOut}}
			        <button data-hull-action="login" data-hull-provider="{{.}}" class="btn btn-default btn-{{.}}">
			          <i class="icon-{{.}}"></i>
			           {{classify .}}
			        </button>
			      {{/loggedOut}}
			    </div>
			    <div id="emailLoginSection" style="display:none">
			    	<input type="text" placeholder="Email" id="emailLoginField"></input>
				<input type="password" placeholder="Password" id="passwordLoginField"></input>
				<button type="button" class="btn btn-default has-spinner" id="emailSigninButton" data-hull-action="signin"><span class="spinner"><i class="icon-spin icon-refresh"></i></span> Login</button>
			    </div>
			    <p>First time? <a href="#" data-hull-action="expandSignup">Sign up now!</a></p>
			    <div id="signupForm" style="display:none">
		        	<input type="text" placeholder="Username" id="usernameField"></input>
		        	<input type="text" placeholder="Email" id="emailField"></input>
				<input type="password" placeholder="Password" id="passwordField"></input>
				<input type="password" placeholder="Confirm Password" id="confirmPasswordField"></input>
				<button type="button" class="btn btn-default has-spinner" id="signupButton" data-hull-action="signup"><span class="spinner"><i class="icon-spin icon-refresh"></i></span> Sign up!</button>
			    </div>
			  {{/if}}
			{{/if}}
	    </script>	
	    
	    <script type='text/x-handlebars' data-hull-template='flaggedposts/flaggedposts'>
	    	<header>
		    	<span class="pageHeader">Flagged Posts</span>
		    </header>
    		{{#each flaggedPosts}}
    		<section>
	    		<span data-postID="{{id}}"><a href="#/post/{{id}}">{{name}}</a></span>
	    		<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
	    		<ul>
	    			<li><a href="#" class='link text-error' data-hull-action="unflag" data-hull-id="{{id}}">Unflag</a></li>
					<li><a href="#" class='link text-error' data-hull-action="deleteItem" data-hull-id="{{id}}">Delete</a></li>
	    		</ul>
    		</section>
			{{/each}}
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/post'>
	        <section data-hull-component="post" data-hull-id="{{id}}"></section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='user/user'>
	        {{#if loggedIn}}
				<section data-hull-component="createtopicform"></section>
		{{/if}}
		<section data-hull-component="mobilesearchform"></section>

		{{#ifEqual feed.length 0}}
			<h1>Nothing to see here!</h1>
			<p>Seems that this users hasn't been active....yet</p>
		{{else}}
		<section class="userId">
		    	<img src={{feed.0.actor.picture}}>
		        <h1>{{feed.0.actor.name}}</h1>
		        <br>
		        <h2>Comment Mojo: {{options.commentMojo}}</h2>
		 </section>
	        <section class="userFeed">
	        <h1>Activity</h1>
	        {{#each feed}}
	            {{#ifEqual object.type "comment"}}
	                {{#if target.name}}
	                <p><a href="#/comment/{{object.id}}">Commented</a> on <a href="#/post/{{target.id}}">{{target.name}}</a></p>
	                {{/if}}
	            {{else}}
	                <p>Reviewed a <a href="#/comment/{{object.reviewable_id}}">comment</a> on a post</p>
	            {{/ifEqual}}
	        {{/each}}
    		</section>
    		
    		<aside id="mainAside">
	    		<h1>
	    			<span class="pageHeader">Topics {{feed.0.actor.name}} is interested in</span>
			</h1>
			{{#ifEqual interestedTopics.length 0}}
				<p>They are not interested in anything!</p>
			{{/ifEqual}}
			        
		       {{#each interestedTopics}}
			        <article>
					<section class="topic">
				        	<h1><a href="#/post/{{id}}">{{name}}</a></h1>
				        	{{#if tags}}
							<ul class="tagFeed">
				                {{#each tags}}
				                    {{#if this}}
				                        <li><a href="#/post/{{this.value}}"><i class="icon-tag icon-large"></i>{{this.label}}</a></li>
				                    {{/if}}
				                {{/each}}
							</ul>
							{{/if}}
							<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
							<ul>
								<li>{{stats.comments}} comments</li>
			            				<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
			            			</ul>
				    	</section>
			        </article>
		    	{{/each}}
	    	</aside>
		{{/ifEqual}}
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='search/search'>
	        {{#if loggedIn}}
				<section data-hull-component="createtopicform"></section>
			{{/if}}
	    	<header>
	        	<span class="pageHeader">Search Results</span>
	    	</header>
	    	<section class="topic">
	        {{#ifEqual searchResults.length 0}}
	        	<p>No results were found</p>
	        {{else}}
		        {{#each searchResults}}
		            {{#if name}}
		                <h1 class="post" data-postID="{{id}}"><a href="#/post/{{id}}">{{name}}</a></h1>
						<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
		                <ul>
							<li>{{stats.comments}} comments</li>
							<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
		                </ul>
		            </section>
		            {{/if}}
		        {{/each}}
	        {{/ifEqual}}
	        </section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/user'>
	        {{#if loggedIn}}
				<section class="loading" data-hull-component="user" data-hull-id="{{id}}"></section>
			{{else}}
				<header>
	        		<span class="pageHeader">You need to login to view user page</span>
				</header>
	    		<div class="login" data-hull-component="mylogin" data-hull-provider="facebook,twitter"></div>
	        {{/if}}
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/search'>
	        <section data-hull-component="search" data-hull-search="{{id}}"></section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/createtopic'>
	        <section data-hull-component="createtopic" data-hull-id="{{id}}"></section>
	    </script>
	        
	    <script type='text/x-handlebars' data-hull-template='createtopic/createtopic'>
    		<header>
	        	<span class="pageHeader">Use Image URL...</span>
	        </header>
	        <section>
		        <form>
			        <input type="text" id="imageURL"></input>
			        <button type="button" class="btn btn-default" id="updateImage" data-hull-action="updateimage">Update Image</button>
		        </form>
		        <header>
	        		<span class="pageHeader">Or Upload an Image...</span>
	        	</header>
			<div data-hull-component="uploads/image@hull" data-hull-id="{{topic.id}}"></div>
			<header>
	        		<span class="pageHeader">Or remove image completely...</span>
	        	</header>
			<button type="button" class="btn btn-default" id="skipimageupload" data-hull-action="skipimageupload">Remove Image</button>
		    </section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/comment'>
	        <section data-hull-component="comment" data-hull-id="{{id}}"></section>
	    </script>
	       
	    <script type='text/x-handlebars' data-hull-template='comment/comment'>
	    {{#if loggedIn}}
	    	<section data-hull-component="createtopicform"></section>
	    {{/if}}
	    <section data-hull-component="mobilesearchform"></section>

	    <section id="mainSection">
	    	<img class="topicImg" src="{{imageUrl post.picture 'large' post.extra.fallbackUrl}}"/>
		<article>
			<section class="comment">
				<img src="{{comment.user.picture}}" class="userImg" alt="{{comment.user.name}}">
				<div class="userComment">
					<span>
						<a href="#/user/{{comment.user.id}}">{{comment.user.name}}</a>
						<time>{{fromNow comment.updated_at}}</time>
					</span>
					<div>
						<p>{{comment.description}}</p>
						{{#if comment.extra.richComment}}
							{{{comment.extra.richComment}}}
						{{/if}}
					</div>
					<section>
						<ul data-hull-component="ratings/vote@hull" data-hull-id="{{comment.id}}"></ul>
						<ul>
							<li>{{post.stats.comments}} comments</li>
							<li>on <a href="#/post/{{post.id}}">{{post.name}}</a></li>
						</ul>
					</section>
					<div data-hull-component="share/button@hull" data-hull-text="{{comment.description}}" data-hull-url="http://zacomments.azurewebsites.net/?comment={{comment.id}}" data-hull-providers='twitter, facebook'></div>
				</div>
			</section>
		</article>
	   </section>
	   
	    <div id="mainAside">
	    	<header>
	    		<span class="pageHeader">Topics related {{post.name}}</span>
	        </header>
		{{#ifEqual postsRelated.length 0}}
	        	<p>No topics at the moment.</p>
	        {{/ifEqual}}
	        
	        {{#each postsRelated}}
	        	<article>
	        		<section class="topic">
	        			<h1><a href="#/post/{{id}}">{{name}}</a></h1>
	        			{{#if tags}}
	        				<ul class="tagFeed">
	        					{{#each tags}}
	        						{{#if this}}
	        							<li><a href="#/post/{{this.value}}"><i class="icon-tag icon-large"></i>{{this.label}}</a></li>
					                    	{{/if}}
					                {{/each}}
				                </ul>
			                {{/if}}
					<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
					<ul>
						<li>{{stats.comments}} comments</li>
			            		<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
			            	</ul>
			    	</section>
		        </article>
	    	{{/each}}
    		</div>
	    </script>
	    		     
	    <script type='text/handlebars' data-hull-template='createtopicform/createtopicform'>
	    	<div class="modal fade" id="createTopicModal" role="dialog">
	    		<div class="modal-dialog">
		      		<!-- Modal content-->
		      		<div class="modal-content">
		        		<div class="modal-header">
		          			<button type="button" class="close" data-dismiss="modal">&times;</button>
		          			<h4 class="modal-title">Create Topic</h4>
		        		</div>
		        		<div class="modal-body">
	    					<section class="createTopic ui-front">
	    						<h4>First: Choose a title for new topic</h4>
		    					<input type="text" placeholder="Topic title" id="newEntityField"></input>
		    					<section id="tagsSection" style="display:none">
			    					<h4>Second: Tag it with some existing tags</h4>
			    					<input type="text" id="tagsField"></input>
		    					</section>
		    					<section id="imageSection" style="display:none">
			    					<h4>Finally: Add an image to it (Optional)</h4>
			    					<div id="imageRadio">
				    					<input type="radio" name="imageSelection" value="url">Use image URL<br>
				    					<input type="text" id="imageURL" style="display:none"></input>
									<input type="radio" name="imageSelection" value="upload">Upload an image<br>
									<div id= "imageUploader" style="display:none">
										<div data-hull-component="uploads/image@hull" data-hull-id="me"></div>
									</div>
									<input type="radio" name="imageSelection" value="none">No image
								</div>
							</section>
    						</section>
    					</div>
		        		<div class="modal-footer">
		       	  			<button type="button" id="createTopic" class="btn btn-default btn-warning has-spinner" data-hull-action="createtopic" disabled>
		       	  			    	<span class="spinner"><i class="icon-spin icon-refresh"></i></span>
		       	  				Create
		       	  			</button>
		          			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        		</div>
	      			</div>
		    	</div>
		  </div>
	    </script>
	    
	    <script type='text/handlebars' data-hull-template='mobilesearchform/mobilesearchform'>
	    	  <div class="modal fade" id="mobileSearchModal" role="dialog">
	    		<div class="modal-dialog">
		      		<!-- Modal content-->
		      		<div class="modal-content">
		        		<div class="modal-body">
		        			<form class="searchFormMobile">
							<input type="text"  placeholder="Search Topics..." id="searchFieldMobile" style="width: 100%">
						</form>
    					</div>
	      			</div>
		    	</div>
		  </div>
	    </script>

	    <script type='text/x-handlebars' data-hull-template='post/post'>
	        {{#if isAdmin}}
	        	<button type="button" id="deleteTopic" class="btn btn-default btn-danger" data-hull-action="deleteTopic">Delete Topic</button>
	        {{/if}}
	        
	        <button type="button" id="updateImage" class="btn btn-default" data-hull-action="updateImage" style="display:none">Change Image</button>
		<section data-hull-component="mobilesearchform"></section>

	        <section id="mainSection">
		        {{#if loggedIn}}
					<section data-hull-component="createtopicform"></section>
				{{/if}}
	        	<article>
			        <section class="topic">
				        <h1 id="postTitle">{{post.name}}</h1>
				        
				        <div id="editableTags" style="display:none">
					        <form class="ui-front">
						        <input type="text" id="postTags"></input>
					        </form>
					        
				        	<button type="button" id="updateTags" class="btn btn-default has-spinner" data-hull-action="updateTags"><span class="spinner"><i class="icon-spin icon-refresh"></i></span> Update Tags</button>
					</div>
					
				        {{#if post.tags}}
				        	<ul class="tagFeed">
			                    	{{#each post.tags}}
			                        	{{#if this}}
			                        		<li><a href="#/post/{{this.value}}"><i class="icon-tag icon-large"></i>{{this.label}}</a></li>
			                        	{{/if}}
			                    	{{/each}}
						</ul>
					{{/if}}
					
				        <img class="topicImg" src="{{imageUrl post.picture 'large' post.extra.fallbackUrl}}"/>
				        <div data-hull-component="share/button@hull" data-hull-text="{{post.name}}" data-hull-url="http://zacomments.azurewebsites.net/?post={{post.id}}" data-hull-providers='twitter, facebook'></div>

				        <ul>
					        <li>{{post.stats.comments}} comments</li>
							<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{post.id}}">Report</a></li>
				        </ul>
				    </section>

					<section class="createComment" data-hull-component="commentbox" data-hull-id="{{post.id}}"></section>
			        <div id="commentstabs">
			        	<ul class="nav nav-tabs">
				        	<li class="active"><a data-toggle="tab" href="#topcomments">Top Comments</a></li>
				        	<li><a data-toggle="tab" href="#newcomments">newcomments</a></li>
			        	</ul>
			        	<div class="tab-content">
			        		<div id="topcomments" class="tab-pane fade in active">
			        			<section data-hull-component="test" data-hull-id="{{post.id}}" data-hull-orderby="votes"></section>
			        		</div>
			        		<div id="newcomments" class="tab-pane fade">
			        			<section data-hull-component="test" data-hull-id="{{post.id}}" data-hull-orderby="date"></section>
			        		</div>
			        	</div>
			        </div>
				</article>	    
		    </section> 
		    
	        <aside id="mainAside">
	        	<ul class="nav nav-tabs">
	        		<li class="active"><a data-toggle="tab" href="#related">Related</a></li>
	        		<li><a data-toggle="tab" href="#tagged">Tagged</a></li>
	        	</ul>
	        	
	        	<div class="tab-content">
	        		<div id="tagged" class="tab-pane fade">
		        		<header>
		       				<span class="pageHeader">Topics tagged with {{post.name}}</span>
			        	</header>
					{{#ifEqual postsUnder.length 0}}
			        		<p>No topics at the moment.</p>
			        	{{/ifEqual}}
			        	{{#each postsUnder}}
			        		<article>
							<section class="topic">
				        			<h1><a href="#/post/{{id}}">{{name}}</a></h1>
				        			{{#if tags}}
									<ul class="tagFeed">
				                			{{#each tags}}
				                    				{{#if this}}
				                        				<li><a href="#/post/{{this.value}}"><i class="icon-tag icon-large"></i>{{this.label}}</a></li>
				                    				{{/if}}
				                			{{/each}}			
									</ul>
								{{/if}}
								<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
								<ul>
									<li>{{stats.comments}} comments</li>
			            					<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
			            				</ul>
				    			</section>
							<section class="createComment" data-hull-component="commentbox" data-hull-id="{{id}}"></section>
							<section data-hull-component="test" data-hull-id="{{id}}" data-hull-orderby="votes"></section>
			        		</article>
			        	{{/each}}
	        		</div>
	        		
	        		<div id="related" class="tab-pane fade in active">
	        			<header>
	       					<span class="pageHeader">Topics related {{post.name}}</span>
		        		</header>
					{{#ifEqual postsRelated.length 0}}
			        		<p>No topics at the moment.</p>
			        	{{/ifEqual}}
			        	{{#each postsRelated}}
			        		<article>
							<section class="topic">
				        			<h1><a href="#/post/{{id}}">{{name}}</a></h1>
				        			{{#if tags}}
									<ul class="tagFeed">
				                			{{#each tags}}
				                    				{{#if this}}
				                        				<li><a href="#/post/{{this.value}}"><i class="icon-tag icon-large"></i>{{this.label}}</a></li>
				                    				{{/if}}
				                			{{/each}}
									</ul>
								{{/if}}
								<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
								<ul>
									<li>{{stats.comments}} comments</li>
			            					<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
			            				</ul>
				    			</section>
							<section class="createComment" data-hull-component="commentbox" data-hull-id="{{id}}"></section>
							<section data-hull-component="test" data-hull-id="{{id}}" data-hull-orderby="votes"></section>
		        			</article>
			    		{{/each}}
	        		</div>
	        	</div>
			</aside>
	    </script>
	    
	    <script type='text/handlebars' data-hull-template='test/test'>
		    {{#if comments}}
		    <section class="commentFeed" class="media-list hull-comments__list">
		        {{#comments}}
				<section class="comment" data-hull-comment-id="{{id}}">
		            <img src={{user.picture}} class="userImg">
		            <div class="userComment">
		            	<span>
			            	<a href="#/user/{{user.id}}">{{user.name}}</a>
			            	<time class="muted">{{fromNow updated_at}}</time>
		            	</span>
					  	<div class="hull-comments__description">
						  	<p>{{description}}</p>
							{{#if extra.richComment}}
						  		{{{extra.richComment}}}
						  	{{/if}}
					  	</div>
					  	<section>
						  	<ul data-hull-component="ratings/vote@hull" data-hull-id="{{id}}"></ul>
			              	<ul class="hull-comments__actions">
			                  	<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
							  	{{#if isDeletable}}
			              		<li><a href="#" class='link' data-hull-action="delete" data-hull-id="{{id}}">Delete</a></li>
			              		{{/if}}
		                	</ul> 
					  	</section>
					</div>
				</section>
				{{/comments}}
		    	{{^comments}}
		    	<footer>
					<p>No more comments</p>
		    	</footer>
				{{/comments}}
				{{#ifEqual options.showLoadMoreButton true}}
		        <button type="button" id="loadMore" data-hull-action="loadMore" class="btn btn-primary btn-block has-spinner"><span class="spinner"><i class="icon-spin icon-refresh"></i></span> Load more comments</button>
				{{/ifEqual}}
			{{/if}}
			</section>
	    </script>
	        
	    <script type='text/handlebars' data-hull-template='ratings/vote/vote'>
	        {{#if loggedIn}}
	        <li><button class="btn btn-small {{outputIf myVote 1 'btn-success'}} dropup" data-hull-action='{{outputIf myVote 1 'unvote' 'upvote'}}'><i class="icon-thumbs-up icon-large"></i> {{votes.up}}</button></li>
	        <li><button class="btn btn-small {{outputIf myVote -1 'btn-fail'}} dropdown" data-hull-action='{{outputIf myVote -1 'unvote' 'downvote'}}'><i class="icon-thumbs-down icon-large"></i> {{votes.down}}</button></li>
			{{/if}}
	    </script>
	    
	    <script type='text/handlebars' data-hull-template='test/form'>
		      {{#if loggedIn}}
		        <form>
		          <div class='media'>
		            <div class="pull-left">
		              <img class="media-object img-rounded, userImg" src="{{me.picture}}" alt="{{me.name}}">
		            </div>
		            <div class="media-body">
		              <div class="linkPreview" id="lp1"></div>
			              <div>
			                <div class='pull-right'>
			                  <small>
			                  </small>
			                </div>
			              </div>
		              </div>
		          </div>
		        </form>
		      {{/if}}
	    </script>
	    
	    <script type='text/handlebars' data-hull-template='commentbox/commentbox'>
			  {{#if loggedIn}}
			    <form  style="overflow:hidden">
			      <div class='media'>
			        <div class="pull-left">
			          <img class="media-object img-rounded, userImg" src="{{me.picture}}" alt="{{me.name}}">
			        </div>
			        <div class="media-body">
			              <div class="linkPreview" id="lp1"></div>
			        </div>
			      </div>
			    </form>
			  {{/if}}
	    </script>
	    
		<script>
	        var rawAllTopics;
	        
	        window.fbAsyncInit = function() {
	        	FB.init({
	        		appId      : '410573635779027',
      				xfbml      : true,
      				version    : 'v2.3'
	        	});
	        };
	        
	        (function(d, s, id){
	        	var js, fjs = d.getElementsByTagName(s)[0];
     			if (d.getElementById(id)) {return;}
			     js = d.createElement(s); js.id = id;
			     js.src = "//connect.facebook.net/en_US/sdk.js";
			     fjs.parentNode.insertBefore(js, fjs);
	        }(document, 'script', 'facebook-jssdk'));
   
	        Hull.init({
	            debug: false, //Enable to see all traces from the app
	            appId : "52e0c2a06b2de9b464000590",
	            orgUrl: "https://d291172a.hullapp.io"
	        }, function(hull, me, app, org){
	        
	            console.log('Here we go!');
	            
	            hull.api('52e138eaf0f1b0ac30000bad/conversations', 'get', {
	                        'visibiliy': 'public',
	                        'limit': 10
	            }).then(function(response) {
	            	console.log("Number of items "  + response.length);
			rawAllTopics = response;
	        	
	                $( "#searchField" ).autocomplete({
	                    source: function(request, response) {
	                    	var searchTokens = request.term.split(/[ ,]+/);
	                    	hull.api('52e138eaf0f1b0ac30000bad/conversations', 'get',{
                                'visibiliy': 'public',
                                where:{
                                    'name': {
                                        '$regex': '.*('+ searchTokens.join('|') +').*', '$options': 'i'
                                    }
                                }
                             }).then(function(hullresponse){
                             	var searchresponse = $.map(hullresponse, function(elementOfArray, indexInArray){
                             		if(elementOfArray.name){
                             			var datum = {
                             				label: elementOfArray.name,
                             				value: elementOfArray.id
                             			}
                             			return datum;
                             		}
                             	});
                             	response(searchresponse);
                             });
	                    },
						appendTo: ".search",
	                    select: function(event, ui) {
	                        event.preventDefault();
	                        $(this).val(ui.item.label);
	                        window.location.href = '#/post/' + ui.item.value;
	                    }
	                });
	                
	                $('#searchField').keyup(function(e){
	    			if(e.keyCode == 13)
	    			{
	    				var searchTerm = $(this).val();
	    				if(searchTerm) {
	    					window.location.href = '#/search/' + searchTerm;
	    				}
	    			}
			});
	                
	            }); //get conversations
	            
	            console.log("Flagged items");
	            Hull.api('/52e138eaf0f1b0ac30000bad/conversations', {
	            	'where': {
	            		'meta.flags': {
	            			'$gt': 0
	            		}
	            	}
	            }).then(function(response){
	            	console.log(response);
	            });
	        
	        }); //Hull.init
	        
	        $('#search').on('click', function() {
	            var searchTerm = $('#searchField').val();
	            if(searchTerm) {
	                window.location.href = '#/search/' + searchTerm;
	            }
	        });
	        
	        var trim = function (str) {
	            return str.replace(/^\s+|\s+$/g, "");
	        };
	        
	        var processRelatedPosts = function(postID) {
	            var dff = $.Deferred();
	            var result = [];
	            var tagsProcessed = 0;
	            var numberOfTags = 0;
	            Hull.api(postID, 'get').then(function(response) {
	                numberOfTags = response.tags.length;
	                $.each(response.tags, function(tagsIndex, tagValue){
	                Hull.data.api('/52e138eaf0f1b0ac30000bad/conversations', 'get', {
	                    'visibility':'public',
	                    where:{
	                    'tags.value':tagValue.value,
	                    },
	                    limit: 10
	                    }).then(function(response){
	                        result = result.concat(response);
	                        tagsProcessed++;
	                    });
	                });
	                    (function wait(){
	                    if(tagsProcessed == numberOfTags) {
	                    dff.resolve(result);
	                    } else {
	                        setTimeout(wait, 100);
	                    }
	            })();
	            });
	          return dff.promise();
	        };
	        
	        var processTags = function(tagsFieldText) {
	            var dff = $.Deferred();
	            var textTags = tagsFieldText.split(',');
	                var numberOfTags = textTags.length;
	                var tagsFinished = 0;
	                var tagsWithID = [];
	        
	                $.each(textTags, function (indexTextTag, valueTextTag) {
	                    if(valueTextTag.length >0) {
	                    	Hull.api('52e138eaf0f1b0ac30000bad/conversations', 'get', {
	                    		'visibiliy': 'public',
	                    		where:{
	                    			'name': {
	                    				'$regex': '^' + valueTextTag  + '$', '$options': 'i'
	                    			}
	                    		}
	                    	}).then(function(response) {
	                    		if(response.length == 0) {
	                    			Hull.api('/52e138eaf0f1b0ac30000bad/conversations', 'post',{
	                    				"public": "true",
	                                                "name": valueTextTag
	                    			}).then(function(response) {
	                    				console.log("Tag Created");
	                                                var datum = {
	                                                    label: valueTextTag,
	                                                    value: response.id
	                                                }
	                                            tagsWithID.push(datum);
	                                            console.log("new tag");
	                                            console.log(++tagsFinished);
	                    			});
	                    		} else {
	                    			var datum = {
	                    				label: valueTextTag,
	                    				value: response[0].id
	                    			}
	                    			tagsWithID.push(datum);
	                    			tagsFinished ++;
	                    			$('.createbuzz').children().removeAttr("disabled");
	                    		}
	                    	});
	                    } else {
	                        tagsFinished ++;
	                    }       
	                });    //end of each
	        
	                (function wait(){
	                    if(tagsFinished == numberOfTags) {
	                        dff.resolve(tagsWithID);
	                    } else {
	                        setTimeout(wait, 100);
	                    }
	                })();
	          return dff.promise();
	        };
	        
	        var notAlreadyAdded = function(collection, element) {
	        	var result = true;
	                for(var i = 0; i < collection.length; i++) {
	                    if(collection[i].id == element) {
	                        result = false;
	                        break;
	                    }
	                }
	                return result;
	        };
	            
	        (function(){
	        
	        })();
 		</script>
 	</body>
</html>
