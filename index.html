<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Zacomments</title>

		<meta name="referrer" content="always"/>
		<meta name="keywords" content="zacomments,comments,topics">
		<meta name="description" content="Your Zacomments all belong to us.">
		
		<link rel="stylesheet" class="cssStatics" type="text/css" href="Facebook-Link-Preview-master/css/stylesheet.css" />
		<link rel="stylesheet" class="cssButtons" type="text/css" href="Facebook-Link-Preview-master/css/linkPreview.css" />
	
		<meta property="og:site_name" content="Zacomments" />
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://zacomments.com" />
		<meta property="og:title" content="Zacomments" />
		<meta property="og:description" content="Your Zacomments all belong to us." />
		
		<meta name="viewport" content="width=device-width">
		
	    <link rel="stylesheet" type="text/css" href="css/styles.css">

		<script type="text/javascript">
		    var Keen=Keen||{configure:function(e){this._cf=e},addEvent:function(e,t,n,i){this._eq=this._eq||[],this._eq.push([e,t,n,i])},setGlobalProperties:function(e){this._gp=e},onChartsReady:function(e){this._ocrq=this._ocrq||[],this._ocrq.push(e)}};(function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://":"http://")+"dc8na2hxrj29i.cloudfront.net/code/keen-2.1.0-min.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();
		
		    // Configure the Keen object with your Project ID and (optional) access keys.
		    Keen.configure({
		        projectId: "52c6e20836bf5a6dd0000015",
		        writeKey: "d523d28ca0cf1406ac6a4275d70c09f31e06fa575355a163f411a81ae4b9caabc73c211a53c93c14286da3e33ebfcb3696e8e5973da40ac16035c28c8f8c38eabcdc6fa15f2474edc748212d748475a62d59d6bcf9479b6b10fa187ae42f1245663fedbeabcc6af28df2dec0f2ff5b0d", // required for sending events
		        readKey: "98ec71562a7174440c4b628f1871282e333dd4e7df76994e3ebc269f49bea6bc356b567e8db69b5a0735d3bd3221cf31ebf5c4c780e61a5388f1550616536c286ecbdad69994dd51c183333c05e7fbe0f51ed695301c7470f6e3cceb2ca5db9c3d81593f41dd26419d5e96460f44380c"    // required for doing analysis
		    });
		</script>
	</head>
	
	<body>
		
		<header id="mainHeader">
			<a class="logo" href="http://zacomments.azurewebsites.net/">zacomments</a>
			<form class="search">			
				<input type="text" id="searchField">
				<button type="button" id="search">Search</button>
	    	</form>
	    	<div class="login" data-hull-component="mylogin" data-hull-provider="facebook,twitter"></div>
		</header>
				
		<main data-hull-component="maincomp"></main>   
	    
	    <script type='text/handlebars' data-hull-template='maincomp/maincomp'>
	        {{#if isAdmin}}
	            <section data-hull-component="flaggedposts"></section>
	        {{/if}}
		        <section id="mainSection" data-hull-component="posts"></section> 
				<aside id="mainAside" data-hull-component="newposts"></aside>
	    </script>
	            
	    <script type='text/x-handlebars' data-hull-template='posts/posts'>
	        {{#if loggedIn}}
	    		<section class="createTopic" data-hull-component="createtopicform"></section>
	    	{{/if}}
	    	<header>
				<span class="pageHeader">Trending Buzz</span>
	    	</header>
	        {{#each trendingPosts}}
	        	{{#if name}}
					<article>
		        		<section class="topic">
			                <h1 data-postID="{{id}}"><a href="#/post/{{id}}">{{name}}</a></h1>
			                {{#if tags}}
							<ul class="tagFeed">
			                    {{#each tags}}
			                        {{#if this}}
			                        	<li><a href="#/post/{{this.value}}">{{this.label}}</a></li>
			                        {{/if}}
			                    {{/each}}
							</ul>
							{{/if}}
							<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/> 
			                <ul>
				                <li>{{stats.comments}} comments</li>
								<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
			                </ul>	
						</section>
						<section class="createComment" data-hull-component="commentbox" data-hull-id="{{id}}"></section>
						<section data-hull-component="test" data-hull-id="{{id}}" data-hull-orderby="votes"></section>								
	        		</article>    		
	            {{/if}}
			{{/each}}
	       <footer>
		       <button type="button" id="loadMoreTrending" data-hull-action="loadMoreTrending">Load more posts</button>
	       </footer>
	    </script>
	    		    			
		<script type='text/x-handlebars' data-hull-template='newposts/newposts'>
			<header>
				<span class="pageHeader">New Buzz</span>
			</header>
			{{#each newPosts}}
				{{#if name}}
				<article>
					<section class="topic">
						<h1 data-postID="{{id}}"><a href="#/post/{{id}}">{{name}}</a></h1>
						{{#if tags}}
						<ul class="tagFeed">
							{{#each tags}}
								{{#if this}}
									<li><a href="#/post/{{this.value}}">{{this.label}}</a></li>
								{{/if}}
							{{/each}}				
						</ul>
						{{/if}}	
						<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>						
						<ul>
							<li>{{stats.comments}} comments</li>
							<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
						</ul>
					</section>
					<section class="createComment" data-hull-component="commentbox" data-hull-id="{{id}}"></section>
					<section data-hull-component="test" data-hull-id="{{id}}" data-hull-orderby="votes"></section>
				</article>					
				{{/if}}
			{{/each}}
			<footer>
				<button type="button" id="loadMore" data-hull-action="loadMore">Load more posts</button>
			</footer>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='mylogin/mylogin'>
		    {{#if authHasFailed}}
			  <p class="alert alert-error">
			    There was an error signing in your account. Maybe you did not approve the app?
			  </p>
		    {{/if}}
			{{#if matchingProviders}}
			  <div class='media'>
			    {{#if me.picture}}
			    <div class="pull-left">
			      <img class="media-object img-rounded" src="{{me.picture}}" alt="{{me.name}}">
			    </div>
			    {{/if}}
			    <div class="pull-right">
			      <a data-hull-action="logout" class="btn">Log Out</a>
			    </div>
			    <!--
			    <div class="media-body">
			      <span class="media-heading">{{me.name}}</span>
			    </div>
			    -->
			  </div>
			{{else}}
			  {{#if loggedOut}}
			    <div class="hull-identity__signin">
			      {{#loggedOut}}
			        <button data-hull-action="login" data-hull-provider="{{.}}" class="btn btn-small btn-{{.}}">
			          <i class="icon-{{.}}"></i>
			          Sign In with {{classify .}}
			        </button>
			      {{/loggedOut}}
			    </div>
			  {{/if}}
			{{/if}}
	    </script>	
	    
	    <script type='text/x-handlebars' data-hull-template='flaggedposts/flaggedposts'>
	    	<header>
		    	<span class="pageHeader">Flagged Posts</span>
		    </header>
    		{{#each flaggedPosts}}
    		<section>
	    		<span data-postID="{{id}}"><a href="#/post/{{id}}">{{name}}</a></span>
	    		<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
	    		<ul>
	    			<li><a href="#" class='link text-error' data-hull-action="unflag" data-hull-id="{{id}}">Unflag</a></li>
					<li><a href="#" class='link text-error' data-hull-action="deleteItem" data-hull-id="{{id}}">Delete</a></li>
	    		</ul>
    		</section>
			{{/each}}
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/post'>
	        <section data-hull-component="post" data-hull-id="{{id}}"></section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='user/user'>
	        {{#if loggedIn}}
				<section data-hull-component="createtopicform"></section>
			{{/if}}
	    	<section class="userId">
		    	<img src={{feed.0.actor.picture}}>
		        <h1>{{feed.0.actor.name}}</h1>
		    </section>
	        <section class="userFeed">
	        {{#each feed}}
	            {{#ifEqual object.type "comment"}}
	                {{#if target.name}}
	                <p><a href="#/comment/{{object.id}}">Commented</a> on <a href="#/post/{{target.id}}">{{target.name}}</a></p>
	                {{/if}}
	            {{else}}
	                <p>Reviewed a <a href="#/comment/{{object.reviewable_id}}">comment</a> on a post</p>
	            {{/ifEqual}}
	        {{/each}}
    		</section>
    		
    		<header>
    			<span class="pageHeader">Topics {{feed.0.actor.name}} is interested in</span>
		        </header>
			{{#ifEqual interestedTopics.length 0}}
		        	<p>He is not interested in anything!</p>
		        {{/ifEqual}}
		        
		        {{#each interestedTopics}}
		        <article>
					<section class="topic">
			        	<h1><a href="#/post/{{id}}">{{name}}</a></h1>
			        	{{#if tags}}
						<ul class="tagFeed">
			                {{#each tags}}
			                    {{#if this}}
			                        <li><a href="#/post/{{this.value}}">{{this.label}}</a></li>
			                    {{/if}}
			                {{/each}}
						</ul>
						{{/if}}
						<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
						<ul>
							<li>{{stats.comments}} comments</li>
		            		<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
		            	</ul>
			    	</section>
		        </article>
		    	{{/each}}
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='search/search'>
	        {{#if loggedIn}}
				<section data-hull-component="createtopicform"></section>
			{{/if}}
	    	<header>
	        	<span class="pageHeader">Search Results</span>
	    	</header>
	    	<section class="topic">
	        {{#ifEqual searchResults.length 0}}
	        	<p>No results were found</p>
	        {{else}}
		        {{#each searchResults}}
		            {{#if name}}
		                <h1 class="post" data-postID="{{id}}"><a href="#/post/{{id}}">{{name}}</a></h1>
						<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
		                <ul>
							<li>{{stats.comments}} comments</li>
							<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
		                </ul>
		            </section>
		            {{/if}}
		        {{/each}}
	        {{/ifEqual}}
	        </section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/user'>
	        {{#if loggedIn}}
				<section data-hull-component="user" data-hull-id="{{id}}"></section>
			{{else}}
				<header>
	        		<span class="pageHeader">You need to login to view user feed</span>
				</header>
	    		<div class="login" data-hull-component="mylogin" data-hull-provider="facebook,twitter"></div>
	        {{/if}}
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/search'>
	        <section data-hull-component="search" data-hull-search="{{id}}"></section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/createtopic'>
	        <section data-hull-component="createtopic" data-hull-id="{{id}}"></section>
	    </script>
	        
	    <script type='text/x-handlebars' data-hull-template='createtopic/createtopic'>
    		<header>
	        	<span class="pageHeader">Use Image URL Or Upload an Image</span>
	        </header>
	        <section>
		        <form>
			        <input type="text" id="imageURL"></input>
			        <button type="button" id="updateImage" data-hull-action="updateimage">Update Image</button>
		        </form>
				<button type="button" id="skipimageupload" data-hull-action="skipimageupload">No thanks</button>
				<div data-hull-component="uploads/image@hull" data-hull-id="{{topic.id}}"></div>
		    </section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='maincomp/comment'>
	        <section data-hull-component="comment" data-hull-id="{{id}}"></section>
	    </script>
	       
	    <script type='text/x-handlebars' data-hull-template='comment/comment'>
	        {{#if loggedIn}}
			<section data-hull-component="createtopicform"></section>
			{{/if}}
			<section class="topic">
		    	<img class="topicImg" src="{{imageUrl post.picture 'large' post.extra.fallbackUrl}}"/>
		     	<section class="comment">
		        	<img src="{{comment.user.picture}}" class="userImg" alt="{{comment.user.name}}">
		        	<div class="userComment">
						<span>
							<a href="#/user/{{comment.user.id}}">{{comment.user.name}}</a>
							<time>{{fromNow comment.updated_at}}</time>
						</span>
						<div>
							<p>{{comment.description}}<p>
							{{#if extra.richComment}}
								{{{extra.richComment}}}
							{{/if}}
						</div>
						<section>
							<ul data-hull-component="ratings/vote@hull" data-hull-id="{{comment.id}}"></ul>
							<ul>
						 		<li>{{post.stats.comments}} comments</li>
						 		<li>on<a href="#/post/{{post.id}}">{{post.name}}</a></li>
						 	</ul>
						</section>
		        	</div>
				</section>
			</section
			
			<header>
	       			<span class="pageHeader">Topics related {{post.name}}</span>
		        </header>
			{{#ifEqual postsRelated.length 0}}
		        	<p>No topics at the moment.</p>
		        {{/ifEqual}}
		        
		        {{#each postsRelated}}
		        <article>
					<section class="topic">
			        	<h1><a href="#/post/{{id}}">{{name}}</a></h1>
			        	{{#if tags}}
						<ul class="tagFeed">
			                {{#each tags}}
			                    {{#if this}}
			                        <li><a href="#/post/{{this.value}}">{{this.label}}</a></li>
			                    {{/if}}
			                {{/each}}
						</ul>
						{{/if}}
						<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
						<ul>
							<li>{{stats.comments}} comments</li>
		            		<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
		            	</ul>
			    	</section>
		        </article>
		    	{{/each}}
	    </script>
	    		     
	    <script type='text/handlebars' data-hull-template='createtopicform/createtopicform'>
	    	<section class="createTopic">
		    	<form>
			    	<input type="text" placeholder="Topic title" id="newEntityField"></input>
			    	<input type="text" placeholder="Add some tags" id="tagsField"></input>
			    	<div id="imageRadio" style="display:none">
				    	<input type="radio" name="imageSelection" value="url">Use image URL<br>
				    	<input type="text" id="imageURL" style="display:none"></input>
					<input type="radio" name="imageSelection" value="upload">Upload an image<br>
					<div id= "imageUploader" data-hull-component="uploads/image@hull" data-hull-id="52e138eaf0f1b0ac30000bad"></div>
					<input type="radio" name="imageSelection" value="none">No image
				</div>
			    	<button type="button" id="createTopic" data-hull-action="createtopic" disabled>Create</button>
		    	</form>
	    	</section>
	    </script>
	    
	    <script type='text/x-handlebars' data-hull-template='post/post'>
	        {{#if isAdmin}}
	        	<button type="button" id="deleteTopic" data-hull-action="deleteTopic">Delete Topic</button>
	        	<button type="button" id="updateImage" data-hull-action="updateImage">Upload Image</button>
	        {{/if}}
	        <section id="mainSection">
		        {{#if loggedIn}}
					<section data-hull-component="createtopicform"></section>
				{{/if}}
	        	<article>
			        <section class="topic">
				        <h1 id="postTitle">{{post.name}}</h1>
				        <form>
					        <input type="text" id="postTags"></input>
				        </form>
				        <img class="topicImg" src="{{imageUrl post.picture 'large' post.extra.fallbackUrl}}"/>
				        <ul>
					        <li>{{post.stats.comments}} comments</li>
							<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{post.id}}">Report</a></li>
				        </ul>
				    </section>
			        {{#if isAdmin}}
			        	<button type="button" id="updateTags" data-hull-action="updateTags">Update Tags</button>
			        {{/if}}
					<section class="createComment" data-hull-component="commentbox" data-hull-id="{{post.id}}"></section>
			        <header>
						<span>Top Comments</span>
			        </header>
					<section data-hull-component="test" data-hull-id="{{post.id}}" data-hull-orderby="votes"></section>
			        <header>
				    	<span>New Comments</span>
			        </header>
					<section data-hull-component="test" data-hull-id="{{post.id}}" data-hull-orderby="date"></section>
				</article>	    
		    </section> 
		    
	        <aside id="mainAside">
		        <header>
	       			<span class="pageHeader">Topics under {{post.name}}</span>
		        </header>
				{{#ifEqual postsUnder.length 0}}
		        <p>No topics at the moment.</p>
		        {{/ifEqual}}
		        {{#each postsUnder}}
		        <article>
					<section class="topic">
			        	<h1><a href="#/post/{{id}}">{{name}}</a></h1>
			        	{{#if tags}}
						<ul class="tagFeed">
			                {{#each tags}}
			                    {{#if this}}
			                        <li><a href="#/post/{{this.value}}">{{this.label}}</a></li>
			                    {{/if}}
			                {{/each}}			
						</ul>
						{{/if}}
						<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
						<ul>
							<li>{{stats.comments}} comments</li>
		            		<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
		            	</ul>
			    	</section>
					<section class="createComment" data-hull-component="commentbox" data-hull-id="{{id}}"></section>
					<section data-hull-component="test" data-hull-id="{{id}}" data-hull-orderby="votes"></section>
		        </article>
		        {{/each}}
		        <header>
	       			<span class="pageHeader">Topics related {{post.name}}</span>
		        </header>
				{{#ifEqual postsRelated.length 0}}
		        <p>No topics at the moment.</p>
		        {{/ifEqual}}
		        {{#each postsRelated}}
		        <article>
					<section class="topic">
			        	<h1><a href="#/post/{{id}}">{{name}}</a></h1>
			        	{{#if tags}}
						<ul class="tagFeed">
			                {{#each tags}}
			                    {{#if this}}
			                        <li><a href="#/post/{{this.value}}">{{this.label}}</a></li>
			                    {{/if}}
			                {{/each}}
						</ul>
						{{/if}}
						<img class="topicImg" src="{{imageUrl picture 'original' extra.fallbackUrl}}"/>
						<ul>
							<li>{{stats.comments}} comments</li>
		            		<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
		            	</ul>
			    	</section>
					<section class="createComment" data-hull-component="commentbox" data-hull-id="{{id}}"></section>
					<section data-hull-component="test" data-hull-id="{{id}}" data-hull-orderby="votes"></section>
		        </article>
		    	{{/each}}
			</aside>
	    </script>
	    
	    <script type='text/handlebars' data-hull-template='test/test'>
		    {{#if comments}}
		    <section class="commentFeed" class="media-list hull-comments__list">
		        {{#comments}}
				<section class="comment" data-hull-comment-id="{{id}}">
		            <img src={{user.picture}} class="userImg">
		            <div class="userComment">
		            	<span>
			            	<a href="#/user/{{user.id}}">{{user.name}}</a>
			            	<time class="muted">{{fromNow updated_at}}</time>
		            	</span>
					  	<div class="hull-comments__description">
						  	<p>{{description}}</p>
							{{#if extra.richComment}}
						  		{{{extra.richComment}}}
						  	{{/if}}
					  	</div>
					  	<section>
						  	<ul data-hull-component="ratings/vote@hull" data-hull-id="{{id}}"></ul>
			              	<ul class="hull-comments__actions">
			                  	<li><a href="#" class="report" class='link text-error' data-hull-action="flag" data-hull-id="{{id}}">Report</a></li>
							  	{{#if isDeletable}}
			              		<li><a href="#" class='link' data-hull-action="delete" data-hull-id="{{id}}">Delete</a></li>
			              		{{/if}}
		                	</ul> 
					  	</section>
					</div>
				</section>
				{{/comments}}
		    	{{^comments}}
		    	<footer>
					<p>No more comments</p>
		    	</footer>
				{{/comments}}
				{{#ifEqual options.showLoadMoreButton true}}
		        <button type="button" id="loadMore" data-hull-action="loadMore">Load more comments</button>
				{{/ifEqual}}
			{{/if}}
			</section>
	    </script>
	        
	    <script type='text/handlebars' data-hull-template='ratings/vote/vote'>
	        {{#if loggedIn}}
	        <li>Upvote<button class="btn btn-small {{outputIf myVote 1 'btn-success'}} dropup" data-hull-action='{{outputIf myVote 1 'unvote' 'upvote'}}'>{{votes.up}}</button></li>
	        <li>Downvote<button class="btn btn-small {{outputIf myVote -1 'btn-success'}} dropdown" data-hull-action='{{outputIf myVote -1 'unvote' 'downvote'}}'>{{votes.down}}</button></li>
			{{/if}}
	    </script>
	    
	    <script type='text/handlebars' data-hull-template='test/form'>
		      {{#if loggedIn}}
		        <form>
		          <div class='media'>
		            <div class="pull-left">
		              <img class="media-object img-rounded, userImg" src="{{me.picture}}" alt="{{me.name}}">
		            </div>
		            <div class="media-body">
		              <div class="linkPreview" id="lp1"></div>
			              <div>
			                <div class='pull-right'>
			                  <small>
			                  </small>
			                </div>
			              </div>
		              </div>
		          </div>
		        </form>
		      {{/if}}
	    </script>
	    
	    <script type='text/handlebars' data-hull-template='commentbox/commentbox'>
			  {{#if loggedIn}}
			    <form>
			      <div class='media'>
			        <div class="pull-left">
			          <img class="media-object img-rounded, userImg" src="{{me.picture}}" alt="{{me.name}}">
			        </div>
			        <div class="media-body">
			              <div class="linkPreview" id="lp1"></div>
			        </div>
			      </div>
			    </form>
			  {{/if}}
	    </script>
	    
		<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>
		<script src="//documentcloud.github.io/underscore/underscore.js"></script>
		<script src="//documentcloud.github.io/backbone/backbone-min.js"></script>
		<script src="//d3f5pyioow99x0.cloudfront.net/0.8/hull.js"></script>
	    <script src="js/jquery.tagsinput.js"></script>
		<script src="js/components.js"></script>
		<script type="text/javascript" src="Facebook-Link-Preview-master/js/linkPreview.js" ></script>
		<script type="text/javascript" src="Facebook-Link-Preview-master/js/linkPreviewRetrieve.js" ></script>

		<script>
	        var arr;
	        var rawAllTopics;
	        
	        Hull.init({
	            debug: false, //Enable to see all traces from the app
	            appId : "52e0c2a06b2de9b464000590",
	            orgUrl: "https://d291172a.hullapp.io"
	        }, function(hull, me, app, org){
	        
	            console.log('Here we go!');
	            
	            hull.api('52e138eaf0f1b0ac30000bad/conversations', 'get', {
	                        'visibiliy': 'public',
	                        'limit': 10
	            }).then(function(response) {
	            	console.log("Number of items "  + response.length);
			rawAllTopics = response;
			
	                arr = $.map(response, function(elementOfArray, indexInArray){
	                    if(elementOfArray.name){
	                        var datum = {
	                        label: elementOfArray.name,
	                        value: elementOfArray.id
	                        }
	                        return datum;
	                    }
	                });
	        	
	                $( "#searchField" ).autocomplete({
	                    source: arr,
						appendTo: ".search",
	                    select: function(event, ui) {
	                        event.preventDefault();
	                        $(this).val(ui.item.label);
	                        window.location.href = '#/post/' + ui.item.value;
	                    }
	                });
	                
	                $('#searchField').keyup(function(e){
	    			if(e.keyCode == 13)
	    			{
	    				var searchTerm = $(this).val();
	    				if(searchTerm) {
	    					window.location.href = '#/search/' + searchTerm;
	    				}
	    			}
			});
	                
	            }); //get conversations
	            
	            console.log("Flagged items");
	            Hull.api('/52e138eaf0f1b0ac30000bad/conversations', {
	            	'where': {
	            		'meta.flags': {
	            			'$gt': 0
	            		}
	            	}
	            }).then(function(response){
	            	console.log(response);
	            });
	        
	        }); //Hull.init
	        
	        $('#search').on('click', function() {
	            var searchTerm = $('#searchField').val();
	            if(searchTerm) {
	                window.location.href = '#/search/' + searchTerm;
	            }
	        });
	        
	        var trim = function (str) {
	            return str.replace(/^\s+|\s+$/g, "");
	        };
	        
	        var processRelatedPosts = function(postID) {
	            var dff = $.Deferred();
	            var result = [];
	            var tagsProcessed = 0;
	            var numberOfTags = 0;
	            Hull.api(postID, 'get').then(function(response) {
	                numberOfTags = response.tags.length;
	                $.each(response.tags, function(tagsIndex, tagValue){
	                Hull.data.api('/52e138eaf0f1b0ac30000bad/conversations', 'get', {
	                    'visibility':'public',
	                    where:{
	                    'tags.value':tagValue.value,
	                    },
	                    limit: 10
	                    }).then(function(response){
	                        result = result.concat(response);
	                        tagsProcessed++;
	                    });
	                });
	                    (function wait(){
	                    if(tagsProcessed == numberOfTags) {
	                    dff.resolve(result);
	                    } else {
	                        setTimeout(wait, 100);
	                    }
	            })();
	            });
	          return dff.promise();
	        };
	        
	        var processTags = function(tagsFieldText) {
	            var dff = $.Deferred();
	            var textTags = tagsFieldText.split(',');
	                var numberOfTags = textTags.length;
	                var tagsFinished = 0;
	                var tagsWithID = [];
	        
	                $.each(textTags, function (indexTextTag, valueTextTag) {
	                    if(valueTextTag.length >0) {
	                        var temp = $.grep(arr, function (elementArr, indexArr){
	                                        return elementArr.label == valueTextTag;
	                                    });
	                                    if(temp[0]){
	                                        //Tag has anID
	                                        tagsWithID.push(temp[0]);
	                                        console.log("existing tag");
	                                        console.log(++tagsFinished);
	                                    } else {
	                                        console.log("laaag");
	                                        console.log(valueTextTag);
	                                        //Tag does not have ID, create new Entity
	                                    Hull.api('52e138eaf0f1b0ac30000bad/conversations', 'get', {
	                                        'visibiliy': 'public',
	                                        where:{
	                                            'name': {
	                                                '$regex': '^' + valueTextTag  + '$', '$options': 'i'
	                                            }
	                                        }
	                                    }).then(function(response) {
	                                        console.log("EEEH");
	                                        console.log(response);
	                                        if(response.length == 0) {
	                                            Hull.api('/52e138eaf0f1b0ac30000bad/conversations', 'post',{
	                                                "public": "true",
	                                                "name": valueTextTag
	                                            }).then(function(response) {
	                                                console.log("Tag Created");
	                                                var datum = {
	                                                    label: valueTextTag,
	                                                    value: response.id
	                                                }
	                                            tagsWithID.push(datum);
	                                            console.log("new tag");
	                                            console.log(++tagsFinished);
	                                           });
	                                        } else {
	                                            tagsFinished ++;
	                                             alert("A tag with the same name already exists!");
	                                             $('.createbuzz').children().removeAttr("disabled");
	                                        }
	                                    });
	                                    }
	                    } else {
	                        tagsFinished ++;
	                    }       
	                });    //end of each
	        
	                (function wait(){
	                    if(tagsFinished == numberOfTags) {
	                        dff.resolve(tagsWithID);
	                    } else {
	                        setTimeout(wait, 100);
	                    }
	                })();
	          return dff.promise();
	        };
	        
	        var notAlreadyAdded = function(collection, element) {
	        	var result = true;
	                for(var i = 0; i < collection.length; i++) {
	                    if(collection[i].id == element) {
	                        result = false;
	                        break;
	                    }
	                }
	                return result;
	        };
	            
	        (function(){
	        
	        })();
 		</script>
 	</body>
</html>
